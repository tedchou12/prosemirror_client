{"code":"webpackHotUpdate(\"licit\",{\"./node_modules/flatted/esm/index.js\":function(module,__webpack_exports__,__webpack_require__){\"use strict\";eval(\"__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"parse\\\", function() { return parse; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \\\"stringify\\\", function() { return stringify; });\\n/*! (c) 2020 Andrea Giammarchi */\\n\\nconst {parse: $parse, stringify: $stringify} = JSON;\\nconst {keys} = Object;\\n\\nconst Primitive = String;   // it could be Number\\nconst primitive = 'string'; // it could be 'number'\\n\\nconst object = 'object';\\n\\nconst noop = (_, value) => value;\\n\\nconst primitives = value => (\\n  value instanceof Primitive ? Primitive(value) : value\\n);\\n\\nconst Primitives = (_, value) => (\\n  typeof value === primitive ? new Primitive(value) : value\\n);\\n\\nconst revive = (input, parsed, output, $) => keys(output).reduce(\\n  (output, key) => {\\n    const value = output[key];\\n    if (value instanceof Primitive) {\\n      const tmp = input[value];\\n      if (typeof tmp === object && !parsed.has(tmp)) {\\n        parsed.add(tmp);\\n        output[key] = $.call(output, key, revive(input, parsed, tmp, $));\\n      } else {\\n        output[key] = $.call(output, key, tmp);\\n      }\\n    } else\\n      output[key] = $.call(output, key, value);\\n    return output;\\n  },\\n  output\\n);\\n\\nconst set = (known, input, value) => {\\n  const index = Primitive(input.push(value) - 1);\\n  known.set(value, index);\\n  return index;\\n};\\n\\nconst parse = (text, reviver) => {\\n  const input = $parse(text, Primitives).map(primitives);\\n  const value = input[0];\\n  const $ = reviver || noop;\\n  const tmp = typeof value === object && value ?\\n              revive(input, new Set, value, $) :\\n              value;\\n  return $.call({'': tmp}, '', tmp);\\n};\\n\\nconst stringify = (value, replacer, space) => {\\n  const $ = replacer && typeof replacer === object ?\\n            (k, v) => (k === '' || -1 < replacer.indexOf(k) ? v : void 0) :\\n            (replacer || noop);\\n  const known = new Map;\\n  const input = [];\\n  const output = [];\\n  let i = +set(known, input, $.call({'': value}, '', value));\\n  let firstRun = !i;\\n  while (i < input.length) {\\n    firstRun = true;\\n    output[i] = $stringify(input[i++], replace, space);\\n  }\\n  return '[' + output.join(',') + ']';\\n  function replace(key, value) {\\n    if (firstRun) {\\n      firstRun = !firstRun;\\n      return value;\\n    }\\n    const after = $.call(this, key, value);\\n    switch (typeof after) {\\n      case object:\\n        if (after === null) return after;\\n      case primitive:\\n        return known.get(after) || set(known, input, after);\\n    }\\n    return after;\\n  }\\n};\\n\\n\\n//# sourceURL=webpack:///./node_modules/flatted/esm/index.js?\")},\"./node_modules/prosemirror-collab/dist/index.es.js\":function(module,__webpack_exports__,__webpack_require__){\"use strict\";eval('__webpack_require__.r(__webpack_exports__);\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"collab\", function() { return collab; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getVersion\", function() { return getVersion; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"rebaseSteps\", function() { return rebaseSteps; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"receiveTransaction\", function() { return receiveTransaction; });\\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"sendableSteps\", function() { return sendableSteps; });\\n/* harmony import */ var prosemirror_state__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! prosemirror-state */ \"./node_modules/prosemirror-state/dist/index.es.js\");\\n\\n\\nvar Rebaseable = function Rebaseable(step, inverted, origin) {\\n  this.step = step;\\n  this.inverted = inverted;\\n  this.origin = origin;\\n};\\n\\n// : ([Rebaseable], [Step], Transform) → [Rebaseable]\\n// Undo a given set of steps, apply a set of other steps, and then\\n// redo them.\\nfunction rebaseSteps(steps, over, transform) {\\n  for (var i = steps.length - 1; i >= 0; i--) { transform.step(steps[i].inverted); }\\n  for (var i$1 = 0; i$1 < over.length; i$1++) { transform.step(over[i$1]); }\\n  var result = [];\\n  for (var i$2 = 0, mapFrom = steps.length; i$2 < steps.length; i$2++) {\\n    var mapped = steps[i$2].step.map(transform.mapping.slice(mapFrom));\\n    mapFrom--;\\n    if (mapped && !transform.maybeStep(mapped).failed) {\\n      transform.mapping.setMirror(mapFrom, transform.steps.length - 1);\\n      result.push(new Rebaseable(mapped, mapped.invert(transform.docs[transform.docs.length - 1]), steps[i$2].origin));\\n    }\\n  }\\n  return result\\n}\\n\\n// This state field accumulates changes that have to be sent to the\\n// central authority in the collaborating group and makes it possible\\n// to integrate changes made by peers into our local document. It is\\n// defined by the plugin, and will be available as the `collab` field\\n// in the resulting editor state.\\nvar CollabState = function CollabState(version, unconfirmed) {\\n  // : number\\n  // The version number of the last update received from the central\\n  // authority. Starts at 0 or the value of the `version` property\\n  // in the option object, for the editor\\'s value when the option\\n  // was enabled.\\n  this.version = version;\\n\\n  // : [Rebaseable]\\n  // The local steps that havent been successfully sent to the\\n  // server yet.\\n  this.unconfirmed = unconfirmed;\\n};\\n\\nfunction unconfirmedFrom(transform) {\\n  var result = [];\\n  for (var i = 0; i < transform.steps.length; i++)\\n    { result.push(new Rebaseable(transform.steps[i],\\n                               transform.steps[i].invert(transform.docs[i]),\\n                               transform)); }\\n  return result\\n}\\n\\nvar collabKey = new prosemirror_state__WEBPACK_IMPORTED_MODULE_0__[\"PluginKey\"](\"collab\");\\n\\n// :: (?Object) → Plugin\\n//\\n// Creates a plugin that enables the collaborative editing framework\\n// for the editor.\\n//\\n//   config::- An optional set of options\\n//\\n//     version:: ?number\\n//     The starting version number of the collaborative editing.\\n//     Defaults to 0.\\n//\\n//     clientID:: ?union<number, string>\\n//     This client\\'s ID, used to distinguish its changes from those of\\n//     other clients. Defaults to a random 32-bit number.\\nfunction collab(config) {\\n  if ( config === void 0 ) config = {};\\n\\n  config = {version: config.version || 0,\\n            clientID: config.clientID == null ? Math.floor(Math.random() * 0xFFFFFFFF) : config.clientID};\\n\\n  return new prosemirror_state__WEBPACK_IMPORTED_MODULE_0__[\"Plugin\"]({\\n    key: collabKey,\\n\\n    state: {\\n      init: function () { return new CollabState(config.version, []); },\\n      apply: function apply(tr, collab) {\\n        var newState = tr.getMeta(collabKey);\\n        if (newState)\\n          { return newState }\\n        if (tr.docChanged)\\n          { return new CollabState(collab.version, collab.unconfirmed.concat(unconfirmedFrom(tr))) }\\n        return collab\\n      }\\n    },\\n\\n    config: config,\\n    // This is used to notify the history plugin to not merge steps,\\n    // so that the history can be rebased.\\n    historyPreserveItems: true\\n  })\\n}\\n\\n// :: (state: EditorState, steps: [Step], clientIDs: [union<number, string>], options: ?Object) → Transaction\\n// Create a transaction that represents a set of new steps received from\\n// the authority. Applying this transaction moves the state forward to\\n// adjust to the authority\\'s view of the document.\\n//\\n//   options::- Additional options.\\n//\\n//     mapSelectionBackward:: ?boolean\\n//     When enabled (the default is `false`), if the current selection\\n//     is a [text selection](#state.TextSelection), its sides are\\n//     mapped with a negative bias for this transaction, so that\\n//     content inserted at the cursor ends up after the cursor. Users\\n//     usually prefer this, but it isn\\'t done by default for reasons\\n//     of backwards compatibility.\\nfunction receiveTransaction(state, steps, clientIDs, options) {\\n  // Pushes a set of steps (received from the central authority) into\\n  // the editor state (which should have the collab plugin enabled).\\n  // Will recognize its own changes, and confirm unconfirmed steps as\\n  // appropriate. Remaining unconfirmed steps will be rebased over\\n  // remote steps.\\n  var collabState = collabKey.getState(state);\\n  var version = collabState.version + steps.length;\\n  var ourID = collabKey.get(state).spec.config.clientID;\\n\\n  // Find out which prefix of the steps originated with us\\n  var ours = 0;\\n  while (ours < clientIDs.length && clientIDs[ours] == ourID) { ++ours; }\\n  var unconfirmed = collabState.unconfirmed.slice(ours);\\n  steps = ours ? steps.slice(ours) : steps;\\n\\n  // If all steps originated with us, we\\'re done.\\n  if (!steps.length)\\n    { return state.tr.setMeta(collabKey, new CollabState(version, unconfirmed)) }\\n\\n  var nUnconfirmed = unconfirmed.length;\\n  var tr = state.tr;\\n  if (nUnconfirmed) {\\n    unconfirmed = rebaseSteps(unconfirmed, steps, tr);\\n  } else {\\n    for (var i = 0; i < steps.length; i++) { tr.step(steps[i]); }\\n    unconfirmed = [];\\n  }\\n\\n  var newCollabState = new CollabState(version, unconfirmed);\\n  if (options && options.mapSelectionBackward && state.selection instanceof prosemirror_state__WEBPACK_IMPORTED_MODULE_0__[\"TextSelection\"]) {\\n    tr.setSelection(prosemirror_state__WEBPACK_IMPORTED_MODULE_0__[\"TextSelection\"].between(tr.doc.resolve(tr.mapping.map(state.selection.anchor, -1)),\\n                                          tr.doc.resolve(tr.mapping.map(state.selection.head, -1)), -1));\\n    tr.updated &= ~1;\\n  }\\n  return tr.setMeta(\"rebased\", nUnconfirmed).setMeta(\"addToHistory\", false).setMeta(collabKey, newCollabState)\\n}\\n\\n// :: (state: EditorState) → ?{version: number, steps: [Step], clientID: union<number, string>, origins: [Transaction]}\\n// Provides data describing the editor\\'s unconfirmed steps, which need\\n// to be sent to the central authority. Returns null when there is\\n// nothing to send.\\n//\\n// `origins` holds the _original_ transactions that produced each\\n// steps. This can be useful for looking up time stamps and other\\n// metadata for the steps, but note that the steps may have been\\n// rebased, whereas the origin transactions are still the old,\\n// unchanged objects.\\nfunction sendableSteps(state) {\\n  var collabState = collabKey.getState(state);\\n  if (collabState.unconfirmed.length == 0) { return null }\\n  return {\\n    version: collabState.version,\\n    steps: collabState.unconfirmed.map(function (s) { return s.step; }),\\n    clientID: collabKey.get(state).spec.config.clientID,\\n    get origins() { return this._origins || (this._origins = collabState.unconfirmed.map(function (s) { return s.origin; })) }\\n  }\\n}\\n\\n// :: (EditorState) → number\\n// Get the version up to which the collab plugin has synced with the\\n// central authority.\\nfunction getVersion(state) {\\n  return collabKey.getState(state).version\\n}\\n\\n\\n//# sourceMappingURL=index.es.js.map\\n\\n\\n//# sourceURL=webpack:///./node_modules/prosemirror-collab/dist/index.es.js?')},\"./src/client/EditorConnection.js\":function(module,__webpack_exports__,__webpack_require__){\"use strict\";eval('__webpack_require__.r(__webpack_exports__);\\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ \"./node_modules/@babel/runtime/helpers/defineProperty.js\");\\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__);\\n/* harmony import */ var prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! prosemirror-collab */ \"./node_modules/prosemirror-collab/dist/index.es.js\");\\n/* harmony import */ var prosemirror_state__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! prosemirror-state */ \"./node_modules/prosemirror-state/dist/index.es.js\");\\n/* harmony import */ var prosemirror_transform__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! prosemirror-transform */ \"./node_modules/prosemirror-transform/dist/index.es.js\");\\n/* harmony import */ var prosemirror_view__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! prosemirror-view */ \"./node_modules/prosemirror-view/dist/index.es.js\");\\n/* harmony import */ var _EditorPlugins__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../EditorPlugins */ \"./src/EditorPlugins.js\");\\n/* harmony import */ var _EditorSchema__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../EditorSchema */ \"./src/EditorSchema.js\");\\n/* harmony import */ var _uuid__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../uuid */ \"./src/uuid.js\");\\n/* harmony import */ var _http__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./http */ \"./src/client/http.js\");\\n/* harmony import */ var prosemirror_model__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! prosemirror-model */ \"./node_modules/prosemirror-model/dist/index.es.js\");\\n/* harmony import */ var flatted__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! flatted */ \"./node_modules/flatted/esm/index.js\");\\n\\n\\n\\n\\n\\n\\n\\n\\n // [FS] IRAD-1040 2020-09-02\\n\\n\\n\\n\\nfunction badVersion(err) {\\n  return err.status == 400 && /invalid version/i.test(String(err));\\n}\\n\\nvar connection = null;\\n\\nclass State {\\n  constructor(edit, comm) {\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"edit\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"comm\", void 0);\\n\\n    this.edit = edit;\\n    this.comm = comm;\\n  }\\n\\n}\\n\\nclass EditorConnection {\\n  constructor(onReady, report, doc_id) {\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"backOff\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"onReady\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"ready\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"report\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"request\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"state\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"url\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"view\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"schema\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"socket\", void 0);\\n\\n    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0___default()(this, \"dispatch\", action => {\\n      let newEditState = null;\\n\\n      if (action.type == \\'loaded\\') {\\n        const editState = prosemirror_state__WEBPACK_IMPORTED_MODULE_2__[\"EditorState\"].create({\\n          doc: action.doc,\\n          plugins: _EditorPlugins__WEBPACK_IMPORTED_MODULE_5__[\"default\"].concat([Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"collab\"])({\\n            clientID: Object(_uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"])(),\\n            version: action.version\\n          })])\\n        });\\n        this.state = new State(editState, \\'poll\\');\\n        this.ready = true;\\n        this.onReady(editState); // this.poll();\\n        // this.cursor_poll();\\n      } else if (action.type == \\'restart\\') {\\n        this.state = new State(null, \\'start\\');\\n        this.ws_start();\\n      } else if (action.type == \\'poll\\') {\\n        this.state = new State(this.state.edit, \\'poll\\'); // this.poll();\\n      } else if (action.type == \\'recover\\') {\\n        if (action.error.status && action.error.status < 500) {\\n          this.report.failure(action.error);\\n          this.state = new State(null, null);\\n        } else {\\n          this.state = new State(this.state.edit, \\'recover\\');\\n          this.recover(action.error);\\n        }\\n      } else if (action.type == \\'transaction\\') {\\n        newEditState = this.state.edit ? this.state.edit.apply(action.transaction) : null;\\n      }\\n\\n      if (newEditState) {\\n        let sendable;\\n\\n        if (newEditState.doc.content.size > 40000) {\\n          if (this.state.comm !== \\'detached\\') {\\n            this.report.failure(\\'Document too big. Detached.\\');\\n          }\\n\\n          this.state = new State(newEditState, \\'detached\\');\\n        } else if ((this.state.comm == \\'poll\\' || action.requestDone) && (sendable = this.sendable(newEditState))) {\\n          this.closeRequest();\\n          this.state = new State(newEditState, \\'send\\');\\n          this.send(newEditState, sendable);\\n        } else if (action.requestDone) {\\n          this.state = new State(newEditState, \\'poll\\');\\n          this.poll();\\n        } else {\\n          this.state = new State(newEditState, this.state.comm);\\n        }\\n      } // Sync the editor with this.state.edit\\n\\n\\n      if (this.state.edit && this.view) {\\n        this.view.updateState(this.state.edit);\\n      }\\n    });\\n\\n    this.schema = null;\\n    this.report = report;\\n    this.doc_id = doc_id;\\n    this.state = new State(null, \\'start\\');\\n    this.request = null;\\n    this.backOff = 0;\\n    this.view = null;\\n    this.dispatch = this.dispatch.bind(this);\\n    this.ready = false;\\n    this.onReady = onReady;\\n    this.socket = null;\\n    connection = this;\\n  } // [FS] IRAD-1040 2020-09-08\\n\\n\\n  getEffectiveSchema() {\\n    return null != this.schema ? this.schema : _EditorSchema__WEBPACK_IMPORTED_MODULE_6__[\"default\"];\\n  } // All state changes go through this\\n\\n\\n  // Send cursor updates to the server\\n  cursor_send(selection) {\\n    const json = JSON.stringify({\\n      selection: selection,\\n      clientID: Object(_uuid__WEBPACK_IMPORTED_MODULE_7__[\"default\"])()\\n    });\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"POST\"])(this.url + \\'/cursor\\', json, \\'application/json\\')).then(data => {\\n      this.report.success();\\n    }, err => {\\n      if (err.status == 410 || badVersion(err)) {\\n        // Too far behind. Revert to server state\\n        this.report.failure(err);\\n      } else if (err) {}\\n    });\\n  } // Send a request for events that have happened since the version\\n  // of the document that the client knows about. This request waits\\n  // for a new version of the document to be created if the client\\n  // is already up-to-date.\\n\\n\\n  cursor_poll() {\\n    const query = \\'version=\\' + Date.now() / 1000;\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"GET\"])(this.url + \\'/cursor?\\' + query)).then(data => {\\n      this.report.success();\\n      data = JSON.parse(data);\\n\\n      if (data) {\\n        console.log(data);\\n      }\\n\\n      this.cursor_poll();\\n    }, err => {\\n      if (err.status == 410 || badVersion(err)) {\\n        // Too far behind. Revert to server state\\n        this.report.failure(err);\\n      } else if (err) {}\\n    });\\n  }\\n\\n  ws_start() {\\n    var ws_url = \\'ws://192.168.1.2:9300\\';\\n    var ws_url = ws_url + \\'?user_id=\\' + this.user_id + \\'&doc_id=\\' + this.doc_id;\\n    this.socket = new WebSocket(ws_url);\\n\\n    this.socket.onopen = function (e) {//does something when socket opens\\n    }; // replaces poll\\n\\n\\n    this.socket.onmessage = function (e) {\\n      this.report.success();\\n      var data = JSON.parse(e.data);\\n\\n      if (data.type == \\'init\\') {\\n        this.dispatch({\\n          type: \\'loaded\\',\\n          doc: this.getEffectiveSchema().nodeFromJSON(data.doc_json),\\n          version: data.version,\\n          users: data.users\\n        });\\n      } else {\\n        this.backOff = 0;\\n\\n        if (data.steps && data.steps.length) {\\n          const tr = Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"receiveTransaction\"])(this.state.edit, data.steps.map(j => prosemirror_transform__WEBPACK_IMPORTED_MODULE_3__[\"Step\"].fromJSON(this.getEffectiveSchema(), j)), data.clientIDs);\\n          this.dispatch({\\n            type: \\'transaction\\',\\n            transaction: tr,\\n            requestDone: true\\n          });\\n        } else {\\n          this.poll();\\n        }\\n      }\\n    }; //try reconnects\\n\\n\\n    this.socket.onclose = function (e) {\\n      // Too far behind. Revert to server state\\n      if (true) {\\n        this.report.failure(err);\\n        this.dispatch({\\n          type: \\'restart\\'\\n        });\\n      } else {}\\n    };\\n  }\\n\\n  ws_send(editState, sendable) {\\n    const {\\n      steps\\n    } = sendable;\\n    const json = JSON.stringify({\\n      version: Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"getVersion\"])(editState),\\n      steps: steps ? steps.steps.map(s => s.toJSON()) : [],\\n      clientID: steps ? steps.clientID : 0\\n    });\\n    this.socket.send(json);\\n    this.report.success();\\n    this.backOff = 0;\\n    const tr = steps ? Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"receiveTransaction\"])(this.state.edit, steps.steps, repeat(steps.clientID, steps.steps.length)) : this.state.edit.tr;\\n    this.dispatch({\\n      type: \\'transaction\\',\\n      transaction: tr,\\n      requestDone: true\\n    });\\n  }\\n\\n  ws_recover() {\\n    const newBackOff = this.backOff ? Math.min(this.backOff * 2, 6e4) : 200;\\n\\n    if (newBackOff > 1000 && this.backOff < 1000) {\\n      this.report.delay(err);\\n    }\\n\\n    this.backOff = newBackOff;\\n    setTimeout(() => {\\n      if (this.state.comm == \\'recover\\') {\\n        this.dispatch({\\n          type: \\'restart\\'\\n        });\\n      }\\n    }, this.backOff);\\n  } // Load the document from the server and start up\\n\\n\\n  start() {\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"GET\"])(this.url)).then(data => {\\n      data = JSON.parse(data);\\n      this.report.success();\\n      this.backOff = 0;\\n      this.dispatch({\\n        type: \\'loaded\\',\\n        doc: this.getEffectiveSchema().nodeFromJSON(data.doc_json),\\n        version: data.version,\\n        users: data.users\\n      });\\n    }, err => {\\n      this.report.failure(err);\\n    });\\n  } // Send a request for events that have happened since the version\\n  // of the document that the client knows about. This request waits\\n  // for a new version of the document to be created if the client\\n  // is already up-to-date.\\n\\n\\n  poll() {\\n    const query = \\'version=\\' + Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"getVersion\"])(this.state.edit);\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"GET\"])(this.url + \\'/events?\\' + query)).then(data => {\\n      this.report.success();\\n      data = JSON.parse(data);\\n      this.backOff = 0;\\n\\n      if (data.steps && data.steps.length) {\\n        const tr = Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"receiveTransaction\"])(this.state.edit, data.steps.map(j => prosemirror_transform__WEBPACK_IMPORTED_MODULE_3__[\"Step\"].fromJSON(this.getEffectiveSchema(), j)), data.clientIDs);\\n        this.dispatch({\\n          type: \\'transaction\\',\\n          transaction: tr,\\n          requestDone: true\\n        });\\n      } else {\\n        this.poll();\\n      }\\n    }, err => {\\n      if (err.status == 410 || badVersion(err)) {\\n        // Too far behind. Revert to server state\\n        this.report.failure(err);\\n        this.dispatch({\\n          type: \\'restart\\'\\n        });\\n      } else if (err) {\\n        this.dispatch({\\n          type: \\'recover\\',\\n          error: err\\n        });\\n      }\\n    });\\n  }\\n\\n  sendable(editState) {\\n    const steps = Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"sendableSteps\"])(editState);\\n\\n    if (steps) {\\n      return {\\n        steps\\n      };\\n    }\\n\\n    return null;\\n  } // Send the given steps to the server\\n\\n\\n  send(editState, sendable) {\\n    const {\\n      steps\\n    } = sendable;\\n    const json = JSON.stringify({\\n      version: Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"getVersion\"])(editState),\\n      steps: steps ? steps.steps.map(s => s.toJSON()) : [],\\n      clientID: steps ? steps.clientID : 0\\n    });\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"POST\"])(this.url + \\'/events\\', json, \\'application/json\\')).then(data => {\\n      this.report.success();\\n      this.backOff = 0;\\n      const tr = steps ? Object(prosemirror_collab__WEBPACK_IMPORTED_MODULE_1__[\"receiveTransaction\"])(this.state.edit, steps.steps, repeat(steps.clientID, steps.steps.length)) : this.state.edit.tr;\\n      this.dispatch({\\n        type: \\'transaction\\',\\n        transaction: tr,\\n        requestDone: true\\n      });\\n    }, err => {\\n      if (err.status == 409) {\\n        // The client\\'s document conflicts with the server\\'s version.\\n        // Poll for changes and then try again.\\n        this.backOff = 0;\\n        this.dispatch({\\n          type: \\'poll\\'\\n        });\\n      } else if (badVersion(err)) {\\n        this.report.failure(err);\\n        this.dispatch({\\n          type: \\'restart\\'\\n        });\\n      } else {\\n        this.dispatch({\\n          type: \\'recover\\',\\n          error: err\\n        });\\n      }\\n    });\\n  } // [FS] IRAD-1040 2020-09-02\\n  // Send the modified schema to server\\n\\n\\n  updateSchema(schema) {\\n    // to avoid cyclic reference error, use flatted string.\\n    const schemaFlatted = Object(flatted__WEBPACK_IMPORTED_MODULE_10__[\"stringify\"])(schema);\\n    this.run(Object(_http__WEBPACK_IMPORTED_MODULE_8__[\"POST\"])(this.url + \\'/schema/\\', schemaFlatted, \\'text/plain\\')).then(data => {\\n      console.log(\"collab server\\'s schema updated\"); // [FS] IRAD-1040 2020-09-08\\n\\n      this.schema = schema;\\n      this.start();\\n    }, err => {\\n      this.report.failure(err);\\n    });\\n  } // Try to recover from an error\\n\\n\\n  recover(err) {\\n    const newBackOff = this.backOff ? Math.min(this.backOff * 2, 6e4) : 200;\\n\\n    if (newBackOff > 1000 && this.backOff < 1000) {\\n      this.report.delay(err);\\n    }\\n\\n    this.backOff = newBackOff;\\n    setTimeout(() => {\\n      if (this.state.comm == \\'recover\\') {\\n        this.dispatch({\\n          type: \\'poll\\'\\n        });\\n      }\\n    }, this.backOff);\\n  }\\n\\n  closeRequest() {\\n    if (this.request) {\\n      this.request.abort();\\n      this.request = null;\\n    }\\n  }\\n\\n  run(request) {\\n    return this.request = request;\\n  }\\n\\n  close() {\\n    this.closeRequest();\\n    this.setView(null);\\n  }\\n\\n  setView(view) {\\n    if (this.view) {\\n      this.view.destroy();\\n    }\\n\\n    this.view = window.view = view;\\n  }\\n\\n}\\n\\nfunction repeat(val, n) {\\n  const result = [];\\n\\n  for (let i = 0; i < n; i++) {\\n    result.push(val);\\n  }\\n\\n  return result;\\n}\\n\\n/* harmony default export */ __webpack_exports__[\"default\"] = (EditorConnection);\\n\\n//# sourceURL=webpack:///./src/client/EditorConnection.js?')}});","extractedComments":["/*!*******************************************!*\\\n  !*** ./node_modules/flatted/esm/index.js ***!\n  \\*******************************************/","/*! exports provided: parse, stringify */","/*!**********************************************************!*\\\n  !*** ./node_modules/prosemirror-collab/dist/index.es.js ***!\n  \\**********************************************************/","/*! exports provided: collab, getVersion, rebaseSteps, receiveTransaction, sendableSteps */","/*!****************************************!*\\\n  !*** ./src/client/EditorConnection.js ***!\n  \\****************************************/","/*! exports provided: default */"]}